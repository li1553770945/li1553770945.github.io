(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{512:function(t,e,s){"use strict";s.r(e);var a=s(20),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("这是一份NGINX的样例配置。可以直接参照这些样例进行配置。\n")]),t._v(" "),s("h2",{attrs:{id:"https-http自动重定向"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#https-http自动重定向"}},[t._v("#")]),t._v(" HTTPS,HTTP自动重定向")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("    server { # 该server表示80端口自动重定向\n        listen 80;\n        server_name _; # 根据需要替换你的server_name\n        rewrite ^(.*)$ https://$host$1 permanent;\n    }\n    server {\n        listen       443 default_server;  #监听443端口\n        listen       [::]:443 default_server;\n        server_name  _;\n        ssl on;\n        ssl_certificate  /root/card/XXX.pem;   #ssl证书的pem文件路径\n        ssl_certificate_key /root/card/XXX.key;  #ssl证书的key文件路径\n        include /etc/nginx/default.d/*.conf;\n        location / { # 静态文件\n            root /root/dist;\n            index index.html;\n            try_files $uri $uri/ /index.html; #解决VUE刷新404问题\n        }\n        \n       \n        error_page 404 /404.html;\n            location = /40x.html {\n        }\n\n        error_page 500 502 503 504 /50x.html;\n            location = /50x.html {\n        }\n    }\n\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br")])]),s("h2",{attrs:{id:"静态文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#静态文件"}},[t._v("#")]),t._v(" 静态文件")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("location / { # 静态文件\n    root /root/dist;\n    index index.html;\n    try_files $uri $uri/ /index.html; #解决VUE刷新404问题\n}\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("h2",{attrs:{id:"转发请求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#转发请求"}},[t._v("#")]),t._v(" 转发请求")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("location /api{\n    proxy_pass http://localhost:8001/api; # 表示后端重定向端口\n}\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("h2",{attrs:{id:"文件下载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#文件下载"}},[t._v("#")]),t._v(" 文件下载")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v(" location / {\n    autoindex on;\n    autoindex_exact_size off;\n    autoindex_localtime on; \n    charset utf-8; # 修复中文文件乱码问题\n}\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("p",[t._v("使用这种方式会自动生成如下页面：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/li1553770945/images/20220402210405.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"大小相关"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#大小相关"}},[t._v("#")]),t._v(" 大小相关")]),t._v(" "),s("h3",{attrs:{id:"设置最大请求体"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置最大请求体"}},[t._v("#")]),t._v(" 设置最大请求体")]),t._v(" "),s("p",[t._v("如果您的服务器有上传文件功能，且出现了413错误，有可能是请求体超过大小限制导致的，需要添加如下配置：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("client_max_body_size 8m;\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h2",{attrs:{id:"超时设置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#超时设置"}},[t._v("#")]),t._v(" 超时设置")]),t._v(" "),s("h3",{attrs:{id:"client-header-timeout"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#client-header-timeout"}},[t._v("#")]),t._v(" client_header_timeout")]),t._v(" "),s("p",[t._v("语法 client_header_timeout time\n默认值 60s\n上下文 http server\n说明 指定等待client发送一个请求头的超时时间（例如：GET / HTTP/1.1）.仅当在一次read中，没有收到请求头，才会算成超时。如果在超时时间内，client没发送任何东西，nginx返回HTTP状态码408(“Request timed out”)")]),t._v(" "),s("h3",{attrs:{id:"client-body-timeout"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#client-body-timeout"}},[t._v("#")]),t._v(" client_body_timeout")]),t._v(" "),s("p",[t._v("语法 client_body_timeout time\n默认值 60s\n上下文 http server location\n说明 该指令设置请求体（request body）的读超时时间。仅当在一次readstep中，没有得到请求体，就会设为超时。超时后，nginx返回HTTP状态码408(“Request timed out”)")]),t._v(" "),s("h3",{attrs:{id:"keepalive-timeout"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#keepalive-timeout"}},[t._v("#")]),t._v(" keepalive_timeout")]),t._v(" "),s("p",[t._v("语法 keepalive_timeout timeout [ header_timeout ]\n默认值 75s\n上下文 http server location\n说明 第一个参数指定了与client的keep-alive连接超时时间。服务器将会在这个时间后关闭连接。可选的第二个参数指定了在响应头Keep-Alive: timeout=time中的time值。这个头能够让一些浏览器主动关闭连接，这样服务器就不必要去关闭连接了。没有这个参数，nginx不会发送Keep-Alive响应头（尽管并不是由这个头来决定连接是否“keep-alive”）\n两个参数的值可并不相同")]),t._v(" "),s("p",[t._v("注意不同浏览器怎么处理“keep-alive”头：")]),t._v(" "),s("ul",[s("li",[t._v('MSIE和Opera忽略掉"Keep-Alive: timeout=< N >" header.')]),t._v(" "),s("li",[t._v("MSIE保持连接大约60-65秒，然后发送TCP RST")]),t._v(" "),s("li",[t._v("Opera永久保持长连接")]),t._v(" "),s("li",[t._v("Mozilla保持N+x(x为大概0-10的随机数)")]),t._v(" "),s("li",[t._v("Konqueror保持长连接N秒")])]),t._v(" "),s("h3",{attrs:{id:"lingering-timeout"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lingering-timeout"}},[t._v("#")]),t._v(" lingering_timeout")]),t._v(" "),s("p",[t._v("语法 lingering_timeout time\n默认值 5s\n上下文 http server location\n说明 lingering_close生效后，在关闭连接前，会检测是否有用户发送的数据到达服务器，如果超过lingering_timeout时间后还没有数据可读，就直接关闭连接；否则，必须在读取完连接缓冲区上的数据并丢弃掉后才会关闭连接。")]),t._v(" "),s("h3",{attrs:{id:"resolver-timeout"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#resolver-timeout"}},[t._v("#")]),t._v(" resolver_timeout")]),t._v(" "),s("p",[t._v("语法 resolver_timeout time\n默认值 30s\n上下文 http server location\n说明 该指令设置DNS解析超时时间")]),t._v(" "),s("h3",{attrs:{id:"proxy-connect-timeout"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#proxy-connect-timeout"}},[t._v("#")]),t._v(" proxy_connect_timeout")]),t._v(" "),s("p",[t._v("语法 proxy_connect_timeout time\n默认值 60s\n上下文 http server location\n说明 该指令设置与upstream server的连接超时时间，有必要记住，这个超时不能超过75秒。\n这个不是等待后端返回页面的时间，那是由proxy_read_timeout声明的。如果你的upstream服务器起来了，但是hanging住了（例如，没有足够的线程处理请求，所以把你的请求放到请求池里稍后处理），那么这个声明是没有用的，由于与upstream服务器的连接已经建立了。")]),t._v(" "),s("h3",{attrs:{id:"proxy-read-timeout"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#proxy-read-timeout"}},[t._v("#")]),t._v(" proxy_read_timeout")]),t._v(" "),s("p",[t._v("语法 proxy_read_timeout time\n默认值 60s\n上下文 http server location\n说明 该指令设置与代理服务器的读超时时间。它决定了nginx会等待多长时间来获得请求的响应。这个时间不是获得整个response的时间，而是两次reading操作的时间。")]),t._v(" "),s("h3",{attrs:{id:"proxy-send-timeout"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#proxy-send-timeout"}},[t._v("#")]),t._v(" proxy_send_timeout")]),t._v(" "),s("p",[t._v("语法 proxy_send_timeout time\n默认值 60s\n上下文 http server location\n说明 这个指定设置了发送请求给upstream服务器的超时时间。超时设置不是为了整个发送期间，而是在两次write操作期间。如果超时后，upstream没有收到新的数据，nginx会关闭连接")]),t._v(" "),s("h3",{attrs:{id:"proxy-upstream-fail-timeout-fail-timeout"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#proxy-upstream-fail-timeout-fail-timeout"}},[t._v("#")]),t._v(" proxy_upstream_fail_timeout（fail_timeout）")]),t._v(" "),s("p",[t._v("语法 server address [fail_timeout=30s]\n默认值 10s\n上下文 upstream\n说明 Upstream模块下 server指令的参数，设置了某一个upstream后端失败了指定次数（max_fails）后，该后端不可操作的时间，默认为10秒")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("参考资料")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.cnblogs.com/lemon-flm/p/8352194.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.cnblogs.com/lemon-flm/p/8352194.html"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=n.exports}}]);
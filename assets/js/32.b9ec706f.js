(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{517:function(t,s,e){"use strict";e.r(s);var a=e(20),i=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("p",[t._v("本文介绍如何在服务器上创建git仓库，并在本地克隆、同步等。")]),t._v(" "),e("p",[t._v("为了方便部署博客，我需要在服务器搭建git仓库，这样以后每次都直接push就行了。如你所见，这篇博客就是我在部署博客的时候写的。")]),t._v(" "),e("h2",{attrs:{id:"_1-安装git"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装git"}},[t._v("#")]),t._v(" 1. 安装git")]),t._v(" "),e("p",[t._v("运行"),e("code",[t._v("yum install git")]),t._v("安装git。我之前认为需要类似于服务器版的git，后来发现不需要，就是我们常用的那个git。")]),t._v(" "),e("h2",{attrs:{id:"_2-创建git用户和git用户组"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建git用户和git用户组"}},[t._v("#")]),t._v(" 2. 创建git用户和git用户组")]),t._v(" "),e("p",[e("code",[t._v("groupadd git")]),t._v("  # 创建git 用户组")]),t._v(" "),e("p",[e("code",[t._v("adduser git -g git")])]),t._v(" "),e("h2",{attrs:{id:"_3-禁止git登录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-禁止git登录"}},[t._v("#")]),t._v(" 3. 禁止git登录")]),t._v(" "),e("p",[t._v("这一步是为了让git用户只能使用git clone等命令，而不能用ssh登录服务器。")]),t._v(" "),e("p",[t._v("修改"),e("code",[t._v("/etc/passwd")]),t._v("文件，将")]),t._v(" "),e("p",[e("code",[t._v("git:x:1001:1001:,,,:/home/git:/bin/bash")])]),t._v(" "),e("p",[t._v("修改为")]),t._v(" "),e("p",[e("code",[t._v("git:x:1001:1001:,,,:/home/git:/usr/bin/git-shell")]),t._v("。")]),t._v(" "),e("h2",{attrs:{id:"_4-创建登录信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-创建登录信息"}},[t._v("#")]),t._v(" 4. 创建登录信息")]),t._v(" "),e("p",[t._v("这一步是为了创建git使用的账号。")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("mkdir /home/git/.ssh $ chmod 700 /home/git/.ssh\n\ntouch 700 /home/git/.ssh/authorized_keys\n\nchmod 600 /home/git/.ssh/authorized_keys\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br")])]),e("p",[t._v("注意以上命令不要用sudo创建，如果已经使用了，或者发现添加了公钥，登录还是要密码，可以使用\n"),e("code",[t._v("sudo chown -R git:git /home/git/.ssh/")]),t._v("来更改拥有者。\n在"),e("mark",[t._v("本地电脑")]),t._v("运行"),e("code",[t._v('ssh-keygen -t rsa -C "youremail@example.com"')]),t._v("，会在用户目录下创建.ssh文件夹，将.ssh/id_rsa.pub文件里面的内容拷贝到"),e("code",[t._v("/home/git/.ssh/authorized_keys")]),t._v("。如果有多台电脑需要登录，则将每个电脑的公钥拷贝进去，一行一个。")]),t._v(" "),e("h2",{attrs:{id:"_5-初始化git仓库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-初始化git仓库"}},[t._v("#")]),t._v(" 5. 初始化git仓库")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("cd /srv\n\nmkdir gitrepo\n\nchown git:git gitrepo/\n\ncd gitrepo\n\ngit init --bare blog.git\n\n# 我是为了搭建博客，你可以根据需要改成其他的名字，.git结尾只是一种规范，并非强制要求\n\nchown -R git:git project.git  #将仓库所属用户改为git \n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br")])]),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("关于`git init -bare`")]),t._v(" "),e("p",[t._v("该命令可以生成一个“裸”git仓库，可以把该仓库用作远程仓库，可以正常push，但无法在该仓库直接进行git操作。如果不设置钩子，进入该文件夹也看不到提交的文件。一般作为服务端的git仓库都用该命令生成。")])]),t._v(" "),e("h2",{attrs:{id:"_6-验证"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-验证"}},[t._v("#")]),t._v(" 6. 验证")]),t._v(" "),e("p",[t._v("在"),e("mark",[t._v("本地")]),t._v("运行\n"),e("code",[t._v("git clone git@服务器地址:/srv/gitrepo/blog.git")])]),t._v(" "),e("h2",{attrs:{id:"_7-设置存储路径"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_7-设置存储路径"}},[t._v("#")]),t._v(" 7. 设置存储路径")]),t._v(" "),e("p",[t._v("这样的操作服务器已经可以当作git仓库用了，但是我们的文件在服务器上不可见，可以按照如下方法：\n可以在远程仓库的hooks目录下新建文件"),e("code",[t._v("post-receive")]),t._v("。\n内容为：")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("#!/bin/bash\ngit --work-tree=/home/www checkout -f\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br")])]),e("p",[t._v("然后添加权限:")]),t._v(" "),e("p",[e("code",[t._v("chown git:git post-receive")])]),t._v(" "),e("p",[e("code",[t._v("chmod +x post-receive")])]),t._v(" "),e("p",[t._v("其中的目录即为你要放置文件的路径。注意git用户需要有访问权限，不然会permition denied。")]),t._v(" "),e("h2",{attrs:{id:"遇到的问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#遇到的问题"}},[t._v("#")]),t._v(" 遇到的问题")]),t._v(" "),e("h3",{attrs:{id:"_1-error-refusing-to-update-checked-out-branch-refs-heads-master"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-error-refusing-to-update-checked-out-branch-refs-heads-master"}},[t._v("#")]),t._v(" 1. error: refusing to update checked out branch: refs/heads/master")]),t._v(" "),e("p",[t._v("让我看看是谁创建仓库的时候没有加"),e("code",[t._v("--bare")]),t._v("?")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("参考文章")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://www.cnblogs.com/shijiaoyun/p/9663396.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.cnblogs.com/shijiaoyun/p/9663396.html"),e("OutboundLink")],1),t._v(" "),e("a",{attrs:{href:"https://www.liaoxuefeng.com/wiki/896043488029600/899998870925664",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.liaoxuefeng.com/wiki/896043488029600/899998870925664"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=i.exports}}]);